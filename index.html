<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pendaftaran Kursus</title>
  <style>
    body { font-family: sans-serif; background: #f9f9f9; padding: 20px; }
    .container { max-width: 700px; margin: auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 5px 10px rgba(0,0,0,0.1); }
    input, textarea { width: 100%; padding: 10px; margin-bottom: 15px; border-radius: 5px; border: 1px solid #ccc; }
    button { padding: 10px 20px; background: #005f73; color: white; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background: #0a9396; }
    .kursus-list input { margin-bottom: 10px; }
  </style>
</head>
<body>

<div class="container">
  <h2>Pendaftaran Kursus Sesi 2025/2026(1)</h2>
  <form id="daftarForm">
    <input type="text" name="nama" placeholder="Nama Pelajar" required>
    <input type="text" name="matrik" placeholder="No Matriks" required>
    <input type="text" name="nokp" placeholder="No Kad Pengenalan" required>
    <input type="tel" name="notel" placeholder="No Telefon" required pattern="[0-9]{10,12}">
    <input type="email" name="emel" placeholder="Alamat Emel" required>
    <textarea name="alamat" placeholder="Alamat Rumah" required></textarea>

    <label><strong>Kursus Yang Didaftarkan</strong></label>
    <div id="kursusContainer" class="kursus-list">
      <input type="text" name="kursus[]" placeholder="Kod & Nama Kursus 1" required>
    </div>
    <button type="button" onclick="tambahKursus()">+ Tambah Kursus</button>

    <br><br>
    <button type="submit">Hantar Pendaftaran</button>
    <p id="status"></p>
  </form>
</div>
  
<div id="paparanSemula" style="display:none; background:#e0f7fa; padding:20px; margin-top:30px; border-radius:10px;">
  <h3>Pengesahan Pendaftaran</h3>
  <p><strong>Nama:</strong> <span id="outNama"></span></p>
  <p><strong>No Matriks:</strong> <span id="outMatrik"></span></p>
  <p><strong>No KP:</strong> <span id="outNoKP"></span></p>
  <p><strong>No Tel:</strong> <span id="outNoTel"></span></p>
  <p><strong>Emel:</strong> <span id="outEmel"></span></p>
  <p><strong>Alamat:</strong> <span id="outAlamat"></span></p>
  <p><strong>Kursus Didaftarkan:</strong>
    <ul id="outKursus"></ul>
  </p>
</div>

<script type="module">
  // Import the functions you need from the Firebase SDKs
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
  import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";

  // TODO: Gantikan dengan konfigurasi Firebase projek anda sendiri
  const firebaseConfig = {
    apiKey: "Ganti_Dengan_YOUR_API_KEY",
    authDomain: "Ganti_Dengan_YOUR_AUTH_DOMAIN",
    projectId: "Ganti_Dengan_YOUR_PROJECT_ID",
    storageBucket: "Ganti_Dengan_YOUR_STORAGE_BUCKET",
    messagingSenderId: "Ganti_Dengan_YOUR_MESSAGING_SENDER_ID",
    appId: "Ganti_Dengan_YOUR_APP_ID"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  let kursusCount = 1;
  const maxKursus = 5;

  window.tambahKursus = function() {
    if (kursusCount >= maxKursus) return alert("Maksimum 5 kursus sahaja.");
    const container = document.getElementById("kursusContainer");
    const input = document.createElement("input");
    input.type = "text";
    input.name = "kursus[]";
    input.placeholder = `Kod & Nama Kursus ${kursusCount + 1}`;
    input.required = true;
    container.appendChild(input);
    kursusCount++;
  }

  document.getElementById("daftarForm").addEventListener("submit", async function(e) {
    e.preventDefault();

    const form = e.target;
    const statusElement = document.getElementById("status");
    statusElement.innerText = "Sedang menghantar...";

    const data = {
      nama: form.nama.value,
      matrik: form.matrik.value,
      nokp: form.nokp.value,
      notel: form.notel.value,
      emel: form.emel.value,
      alamat: form.alamat.value,
      kursus: Array.from(form.querySelectorAll('input[name="kursus[]"]')).map(i => i.value).filter(value => value.trim() !== '').slice(0, 5),
      tarikhHantar: new Date()
    };

    try {
      const docRef = await addDoc(collection(db, "pendaftaran_kursus"), data);
      
      statusElement.innerText = "Pendaftaran berjaya dihantar!";
      form.reset();
      kursusCount = 1;
      document.getElementById("kursusContainer").innerHTML = '<input type="text" name="kursus[]" placeholder="Kod & Nama Kursus 1" required>';

      document.getElementById("outNama").innerText = data.nama;
      document.getElementById("outMatrik").innerText = data.matrik;
      document.getElementById("outNoKP").innerText = data.nokp;
      document.getElementById("outNoTel").innerText = data.notel;
      document.getElementById("outEmel").innerText = data.emel;
      document.getElementById("outAlamat").innerText = data.alamat;

      const kursusList = document.getElementById("outKursus");
      kursusList.innerHTML = "";
      data.kursus.forEach(k => {
        const li = document.createElement("li");
        li.innerText = k;
        kursusList.appendChild(li);
      });

      document.getElementById("paparanSemula").style.display = "block";
      console.log("Dokumen berjaya ditulis dengan ID: ", docRef.id);

    } catch (error) {
      statusElement.innerText = "Ralat semasa menghantar pendaftaran. Sila cuba lagi.";
      console.error("Ralat menambah dokumen: ", error);
    }
  });
</script>
</body>
</html>
